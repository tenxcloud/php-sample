(function(k){var E,F,G,H,I,J,r={},K={},s={},L={treeId:"",treeObj:null,view:{addDiyDom:null,autoCancelSelected:!0,dblClickExpand:!0,expandSpeed:"fast",fontCss:{},nameIsHTML:!1,selectedMulti:!0,showIcon:!0,showLine:!0,showTitle:!0},data:{key:{children:"children",name:"name",title:"",url:"url"},simpleData:{enable:!1,idKey:"id",pIdKey:"pId",rootPId:null},keep:{parent:!1,leaf:!1}},async:{enable:!1,contentType:"application/x-www-form-urlencoded",type:"post",dataType:"text",url:"",autoParam:[],otherParam:[],dataFilter:null},callback:{beforeAsync:null,beforeClick:null,beforeDblClick:null,beforeRightClick:null,beforeMouseDown:null,beforeMouseUp:null,beforeExpand:null,beforeCollapse:null,beforeRemove:null,onAsyncError:null,onAsyncSuccess:null,onNodeCreated:null,onClick:null,onDblClick:null,onRightClick:null,onMouseDown:null,onMouseUp:null,onExpand:null,onCollapse:null,onRemove:null}},t=[function(t){var n=t.treeObj,o=e.event;n.bind(o.NODECREATED,function(e,n,o){j.apply(t.callback.onNodeCreated,[e,n,o])});n.bind(o.CLICK,function(e,n,o,r,a){j.apply(t.callback.onClick,[n,o,r,a])});n.bind(o.EXPAND,function(e,n,o){j.apply(t.callback.onExpand,[e,n,o])});n.bind(o.COLLAPSE,function(e,n,o){j.apply(t.callback.onCollapse,[e,n,o])});n.bind(o.ASYNC_SUCCESS,function(e,n,o,r){j.apply(t.callback.onAsyncSuccess,[e,n,o,r])});n.bind(o.ASYNC_ERROR,function(e,n,o,r,a,i){j.apply(t.callback.onAsyncError,[e,n,o,r,a,i])})}],u=[function(t){var n=e.event;t.treeObj.unbind(n.NODECREATED).unbind(n.CLICK).unbind(n.EXPAND).unbind(n.COLLAPSE).unbind(n.ASYNC_SUCCESS).unbind(n.ASYNC_ERROR)}],v=[function(e){var t=h.getCache(e);t||(t={},h.setCache(e,t));t.nodes=[];t.doms=[]}],w=[function(e,t,n,o,r,a){if(n){var i=h.getRoot(e),d=e.data.key.children;n.level=t;n.tId=e.treeId+"_"+ ++i.zId;n.parentTId=o?o.tId:null;if(n[d]&&n[d].length>0){if(typeof n.open=="string")n.open=j.eqs(n.open,"true");n.open=!!n.open;n.isParent=!0;n.zAsync=!0}else{n.open=!1;if(typeof n.isParent=="string")n.isParent=j.eqs(n.isParent,"true");n.isParent=!!n.isParent;n.zAsync=!n.isParent}n.isFirstNode=r;n.isLastNode=a;n.getParentNode=function(){return h.getNodeCache(e,n.parentTId)};n.getPreNode=function(){return h.getPreNode(e,n)};n.getNextNode=function(){return h.getNextNode(e,n)};n.isAjaxing=!1;h.fixPIdKeyValue(e,n)}}],x=[function(t){var n=t.target,o=h.getSetting(t.data.treeId),r="",a=null,i="",d="",l=null,s=null,c=null;if(j.eqs(t.type,"mousedown"))d="mousedown";else if(j.eqs(t.type,"mouseup"))d="mouseup";else if(j.eqs(t.type,"contextmenu"))d="contextmenu";else if(j.eqs(t.type,"click"))if(j.eqs(n.tagName,"span")&&n.getAttribute("treeNode"+e.id.SWITCH)!==null)r=(k(n).parent("li").get(0)||k(n).parentsUntil("li").parent().get(0)).id,i="switchNode";else{if(c=j.getMDom(o,n,[{tagName:"a",attrName:"treeNode"+e.id.A}]))r=(k(c).parent("li").get(0)||k(c).parentsUntil("li").parent().get(0)).id,i="clickNode"}else if(j.eqs(t.type,"dblclick")&&(d="dblclick",c=j.getMDom(o,n,[{tagName:"a",attrName:"treeNode"+e.id.A}])))r=(k(c).parent("li").get(0)||k(c).parentsUntil("li").parent().get(0)).id,i="switchNode";if(d.length>0&&r.length==0&&(c=j.getMDom(o,n,[{tagName:"a",attrName:"treeNode"+e.id.A}])))r=(k(c).parent("li").get(0)||k(c).parentsUntil("li").parent().get(0)).id;if(r.length>0)switch(a=h.getNodeCache(o,r),i){case"switchNode":a.isParent?j.eqs(t.type,"click")||j.eqs(t.type,"dblclick")&&j.apply(o.view.dblClickExpand,[o.treeId,a],o.view.dblClickExpand)?l=E:i="":i="";break;case"clickNode":l=F}switch(d){case"mousedown":s=G;break;case"mouseup":s=H;break;case"dblclick":s=I;break;case"contextmenu":s=J}return{stop:!1,node:a,nodeEventType:i,nodeEventCallback:l,treeEventType:d,treeEventCallback:s}}],y=[function(e){var t=h.getRoot(e);t||(t={},h.setRoot(e,t));t[e.data.key.children]=[];t.expandTriggerFlag=!1;t.curSelectedList=[];t.noSelection=!0;t.createdNodes=[];t.zId=0;t._ver=(new Date).getTime()}],z=[],A=[],B=[],C=[],D=[],h={addNodeCache:function(e,t){h.getCache(e).nodes[h.getNodeCacheId(t.tId)]=t},getNodeCacheId:function(e){return e.substring(e.lastIndexOf("_")+1)},addAfterA:function(e){A.push(e)},addBeforeA:function(e){z.push(e)},addInnerAfterA:function(e){C.push(e)},addInnerBeforeA:function(e){B.push(e)},addInitBind:function(e){t.push(e)},addInitUnBind:function(e){u.push(e)},addInitCache:function(e){v.push(e)},addInitNode:function(e){w.push(e)},addInitProxy:function(e){x.push(e)},addInitRoot:function(e){y.push(e)},addNodesData:function(e,t,n){var o=e.data.key.children;t[o]||(t[o]=[]);if(t[o].length>0)t[o][t[o].length-1].isLastNode=!1,i.setNodeLineIcos(e,t[o][t[o].length-1]);t.isParent=!0;t[o]=t[o].concat(n)},addSelectedNode:function(e,t){var n=h.getRoot(e);h.isSelectedNode(e,t)||n.curSelectedList.push(t)},addCreatedNode:function(e,t){(e.callback.onNodeCreated||e.view.addDiyDom)&&h.getRoot(e).createdNodes.push(t)},addZTreeTools:function(e){D.push(e)},exSetting:function(e){k.extend(!0,L,e)},fixPIdKeyValue:function(e,t){e.data.simpleData.enable&&(t[e.data.simpleData.pIdKey]=t.parentTId?t.getParentNode()[e.data.simpleData.idKey]:e.data.simpleData.rootPId)},getAfterA:function(e,t,n){for(var o=0,r=A.length;o<r;o++)A[o].apply(this,arguments)},getBeforeA:function(e,t,n){for(var o=0,r=z.length;o<r;o++)z[o].apply(this,arguments)},getInnerAfterA:function(e,t,n){for(var o=0,r=C.length;o<r;o++)C[o].apply(this,arguments)},getInnerBeforeA:function(e,t,n){for(var o=0,r=B.length;o<r;o++)B[o].apply(this,arguments)},getCache:function(e){return s[e.treeId]},getNextNode:function(e,t){if(!t)return null;for(var n=e.data.key.children,o=t.parentTId?t.getParentNode():h.getRoot(e),r=0,a=o[n].length-1;r<=a;r++)if(o[n][r]===t)return r==a?null:o[n][r+1];return null},getNodeByParam:function(e,t,n,o){if(!t||!n)return null;for(var r=e.data.key.children,a=0,i=t.length;a<i;a++){if(t[a][n]==o)return t[a];var d=h.getNodeByParam(e,t[a][r],n,o);if(d)return d}return null},getNodeCache:function(e,t){if(!t)return null;var n=s[e.treeId].nodes[h.getNodeCacheId(t)];return n?n:null},getNodeName:function(e,t){return""+t[e.data.key.name]},getNodeTitle:function(e,t){return""+t[e.data.key.title===""?e.data.key.name:e.data.key.title]},getNodes:function(e){return h.getRoot(e)[e.data.key.children]},getNodesByParam:function(e,t,n,o){if(!t||!n)return[];for(var r=e.data.key.children,a=[],i=0,d=t.length;i<d;i++)t[i][n]==o&&a.push(t[i]),a=a.concat(h.getNodesByParam(e,t[i][r],n,o));return a},getNodesByParamFuzzy:function(e,t,n,o){if(!t||!n)return[];for(var r=e.data.key.children,a=[],o=o.toLowerCase(),i=0,d=t.length;i<d;i++)typeof t[i][n]=="string"&&t[i][n].toLowerCase().indexOf(o)>-1&&a.push(t[i]),a=a.concat(h.getNodesByParamFuzzy(e,t[i][r],n,o));return a},getNodesByFilter:function(e,t,n,o,r){if(!t)return o?null:[];for(var a=e.data.key.children,i=o?null:[],d=0,l=t.length;d<l;d++){if(j.apply(n,[t[d],r],!1)){if(o)return t[d];i.push(t[d])}var s=h.getNodesByFilter(e,t[d][a],n,o,r);if(o&&s)return s;i=o?s:i.concat(s)}return i},getPreNode:function(e,t){if(!t)return null;for(var n=e.data.key.children,o=t.parentTId?t.getParentNode():h.getRoot(e),r=0,a=o[n].length;r<a;r++)if(o[n][r]===t)return r==0?null:o[n][r-1];return null},getRoot:function(e){return e?K[e.treeId]:null},getSetting:function(e){return r[e]},getSettings:function(){return r},getZTreeTools:function(e){return(e=this.getRoot(this.getSetting(e)))?e.treeTools:null},initCache:function(e){for(var t=0,n=v.length;t<n;t++)v[t].apply(this,arguments)},initNode:function(e,t,n,o,r,a){for(var i=0,d=w.length;i<d;i++)w[i].apply(this,arguments)},initRoot:function(e){for(var t=0,n=y.length;t<n;t++)y[t].apply(this,arguments)},isSelectedNode:function(e,t){for(var n=h.getRoot(e),o=0,r=n.curSelectedList.length;o<r;o++)if(t===n.curSelectedList[o])return!0;return!1},removeNodeCache:function(e,t){var n=e.data.key.children;if(t[n])for(var o=0,r=t[n].length;o<r;o++)arguments.callee(e,t[n][o]);h.getCache(e).nodes[h.getNodeCacheId(t.tId)]=null},removeSelectedNode:function(e,t){for(var n=h.getRoot(e),o=0,r=n.curSelectedList.length;o<r;o++)if(t===n.curSelectedList[o]||!h.getNodeCache(e,n.curSelectedList[o].tId))n.curSelectedList.splice(o,1),o--,r--},setCache:function(e,t){s[e.treeId]=t},setRoot:function(e,t){K[e.treeId]=t},setZTreeTools:function(e,t){for(var n=0,o=D.length;n<o;n++)D[n].apply(this,arguments)},transformToArrayFormat:function(e,t){if(!t)return[];var n=e.data.key.children,o=[];if(j.isArray(t))for(var r=0,a=t.length;r<a;r++)o.push(t[r]),t[r][n]&&(o=o.concat(h.transformToArrayFormat(e,t[r][n])));else o.push(t),t[n]&&(o=o.concat(h.transformToArrayFormat(e,t[n])));return o},transformTozTreeFormat:function(e,t){var n,o,r=e.data.simpleData.idKey,a=e.data.simpleData.pIdKey,i=e.data.key.children;if(!r||r==""||!t)return[];if(j.isArray(t)){var d=[],l=[];for(n=0,o=t.length;n<o;n++)l[t[n][r]]=t[n];for(n=0,o=t.length;n<o;n++)l[t[n][a]]&&t[n][r]!=t[n][a]?(l[t[n][a]][i]||(l[t[n][a]][i]=[]),l[t[n][a]][i].push(t[n])):d.push(t[n]);return d}else return[t]}},m={bindEvent:function(e){for(var n=0,o=t.length;n<o;n++)t[n].apply(this,arguments)},unbindEvent:function(e){for(var t=0,n=u.length;t<n;t++)u[t].apply(this,arguments)},bindTree:function(e){var t={treeId:e.treeId},e=e.treeObj;e.bind("selectstart",function(e){e=e.originalEvent.srcElement.nodeName.toLowerCase();return e==="input"||e==="textarea"}).css({"-moz-user-select":"-moz-none"});e.bind("click",t,m.proxy);e.bind("dblclick",t,m.proxy);e.bind("mouseover",t,m.proxy);e.bind("mouseout",t,m.proxy);e.bind("mousedown",t,m.proxy);e.bind("mouseup",t,m.proxy);e.bind("contextmenu",t,m.proxy)},unbindTree:function(e){e.treeObj.unbind("click",m.proxy).unbind("dblclick",m.proxy).unbind("mouseover",m.proxy).unbind("mouseout",m.proxy).unbind("mousedown",m.proxy).unbind("mouseup",m.proxy).unbind("contextmenu",m.proxy)},doProxy:function(e){for(var t=[],n=0,o=x.length;n<o;n++){var r=x[n].apply(this,arguments);t.push(r);if(r.stop)break}return t},proxy:function(e){var t=h.getSetting(e.data.treeId);if(!j.uCanDo(t,e))return!0;for(var t=m.doProxy(e),n=!0,o=0,r=t.length;o<r;o++){var a=t[o];a.nodeEventCallback&&(n=a.nodeEventCallback.apply(a,[e,a.node])&&n);a.treeEventCallback&&(n=a.treeEventCallback.apply(a,[e,a.node])&&n)}return n}};E=function(e,t){var n=h.getSetting(e.data.treeId);if(t.open){if(j.apply(n.callback.beforeCollapse,[n.treeId,t],!0)==!1)return!0}else if(j.apply(n.callback.beforeExpand,[n.treeId,t],!0)==!1)return!0;h.getRoot(n).expandTriggerFlag=!0;i.switchNode(n,t);return!0};F=function(t,n){var o=h.getSetting(t.data.treeId),r=o.view.autoCancelSelected&&t.ctrlKey&&h.isSelectedNode(o,n)?0:o.view.autoCancelSelected&&t.ctrlKey&&o.view.selectedMulti?2:1;if(j.apply(o.callback.beforeClick,[o.treeId,n,r],!0)==!1)return!0;r===0?i.cancelPreSelectedNode(o,n):i.selectNode(o,n,r===2);o.treeObj.trigger(e.event.CLICK,[t,o.treeId,n,r]);return!0};G=function(e,t){var n=h.getSetting(e.data.treeId);j.apply(n.callback.beforeMouseDown,[n.treeId,t],!0)&&j.apply(n.callback.onMouseDown,[e,n.treeId,t]);return!0};H=function(e,t){var n=h.getSetting(e.data.treeId);j.apply(n.callback.beforeMouseUp,[n.treeId,t],!0)&&j.apply(n.callback.onMouseUp,[e,n.treeId,t]);return!0};I=function(e,t){var n=h.getSetting(e.data.treeId);j.apply(n.callback.beforeDblClick,[n.treeId,t],!0)&&j.apply(n.callback.onDblClick,[e,n.treeId,t]);return!0};J=function(e,t){var n=h.getSetting(e.data.treeId);j.apply(n.callback.beforeRightClick,[n.treeId,t],!0)&&j.apply(n.callback.onRightClick,[e,n.treeId,t]);return typeof n.callback.onRightClick!="function"};var j={apply:function(e,t,n){return typeof e=="function"?e.apply(M,t?t:[]):n},canAsync:function(e,t){var n=e.data.key.children;return e.async.enable&&t&&t.isParent&&!(t.zAsync||t[n]&&t[n].length>0)},clone:function(e){if(e===null)return null;var t=e.constructor===Array?[]:{},n;for(n in e)t[n]=e[n]instanceof Date?new Date(e[n].getTime()):typeof e[n]==="object"?arguments.callee(e[n]):e[n];return t},eqs:function(e,t){return e.toLowerCase()===t.toLowerCase()},isArray:function(e){return Object.prototype.toString.apply(e)==="[object Array]"},getMDom:function(e,t,n){if(!t)return null;for(;t&&t.id!==e.treeId;){for(var o=0,r=n.length;t.tagName&&o<r;o++)if(j.eqs(t.tagName,n[o].tagName)&&t.getAttribute(n[o].attrName)!==null)return t;t=t.parentNode}return null},uCanDo:function(){return!0}},i={addNodes:function(t,n,o,r){if(!t.data.keep.leaf||!n||n.isParent)if(j.isArray(o)||(o=[o]),t.data.simpleData.enable&&(o=h.transformTozTreeFormat(t,o)),n){var a=k("#"+n.tId+e.id.SWITCH),d=k("#"+n.tId+e.id.ICON),l=k("#"+n.tId+e.id.UL);if(!n.open)i.replaceSwitchClass(n,a,e.folder.CLOSE),i.replaceIcoClass(n,d,e.folder.CLOSE),n.open=!1,l.css({display:"none"});h.addNodesData(t,n,o);i.createNodes(t,n.level+1,o,n);r||i.expandCollapseParentNode(t,n,!0)}else h.addNodesData(t,h.getRoot(t),o),i.createNodes(t,0,o,null)},appendNodes:function(e,t,n,o,r,a){if(!n)return[];for(var d=[],l=e.data.key.children,s=0,c=n.length;s<c;s++){var u=n[s];if(r){var p=(o?o:h.getRoot(e))[l].length==n.length&&s==0;h.initNode(e,t,u,o,p,s==n.length-1,a);h.addNodeCache(e,u)}p=[];u[l]&&u[l].length>0&&(p=i.appendNodes(e,t+1,u[l],u,r,a&&u.open));a&&(i.makeDOMNodeMainBefore(d,e,u),i.makeDOMNodeLine(d,e,u),h.getBeforeA(e,u,d),i.makeDOMNodeNameBefore(d,e,u),h.getInnerBeforeA(e,u,d),i.makeDOMNodeIcon(d,e,u),h.getInnerAfterA(e,u,d),i.makeDOMNodeNameAfter(d,e,u),h.getAfterA(e,u,d),u.isParent&&u.open&&i.makeUlHtml(e,u,d,p.join("")),i.makeDOMNodeMainAfter(d,e,u),h.addCreatedNode(e,u))}return d},appendParentULDom:function(t,n){var o=[],r=k("#"+n.tId),a=k("#"+n.tId+e.id.UL),d=i.appendNodes(t,n.level+1,n[t.data.key.children],n,!1,!0);i.makeUlHtml(t,n,o,d.join(""));!r.get(0)&&n.parentTId&&(i.appendParentULDom(t,n.getParentNode()),r=k("#"+n.tId));a.get(0)&&a.remove();r.append(o.join(""))},asyncNode:function(b,a,c,d){var f,g;if(a&&!a.isParent)return j.apply(d),!1;else if(a&&a.isAjaxing)return!1;else if(j.apply(b.callback.beforeAsync,[b.treeId,a],!0)==!1)return j.apply(d),!1;if(a)a.isAjaxing=!0,k("#"+a.tId+e.id.ICON).attr({style:"","class":e.className.BUTTON+" "+e.className.ICO_LOADING});var l={};for(f=0,g=b.async.autoParam.length;a&&f<g;f++){var q=b.async.autoParam[f].split("="),o=q;q.length>1&&(o=q[1],q=q[0]);l[o]=a[q]}if(j.isArray(b.async.otherParam))for(f=0,g=b.async.otherParam.length;f<g;f+=2)l[b.async.otherParam[f]]=b.async.otherParam[f+1];else for(var m in b.async.otherParam)l[m]=b.async.otherParam[m];var n=h.getRoot(b)._ver;k.ajax({contentType:b.async.contentType,type:b.async.type,url:j.apply(b.async.url,[b.treeId,a],b.async.url),data:l,dataType:b.async.dataType,success:function(f){if(n==h.getRoot(b)._ver){var g=[];try{g=!f||f.length==0?[]:typeof f=="string"?eval("("+f+")"):f}catch(l){g=f}if(a)a.isAjaxing=null,a.zAsync=!0;i.setNodeLineIcos(b,a);g&&g!==""?(g=j.apply(b.async.dataFilter,[b.treeId,a,g],g),i.addNodes(b,a,g?j.clone(g):[],!!c)):i.addNodes(b,a,[],!!c);b.treeObj.trigger(e.event.ASYNC_SUCCESS,[b.treeId,a,f]);j.apply(d)}},error:function(t,o,r){if(n==h.getRoot(b)._ver){if(a)a.isAjaxing=null;i.setNodeLineIcos(b,a);b.treeObj.trigger(e.event.ASYNC_ERROR,[b.treeId,a,t,o,r])}}});return!0},cancelPreSelectedNode:function(t,n){for(var o=h.getRoot(t).curSelectedList,r=o.length-1;r>=0;r--)if(!n||n===o[r])if(k("#"+o[r].tId+e.id.A).removeClass(e.node.CURSELECTED),n){h.removeSelectedNode(t,n);break}if(!n)h.getRoot(t).curSelectedList=[]},createNodeCallback:function(t){if(t.callback.onNodeCreated||t.view.addDiyDom)for(var n=h.getRoot(t);n.createdNodes.length>0;){var o=n.createdNodes.shift();j.apply(t.view.addDiyDom,[t.treeId,o]);t.callback.onNodeCreated&&t.treeObj.trigger(e.event.NODECREATED,[t.treeId,o])}},createNodes:function(t,n,o,r){if(o&&o.length!=0){var a=h.getRoot(t),d=t.data.key.children,d=!r||r.open||!!k("#"+r[d][0].tId).get(0);a.createdNodes=[];n=i.appendNodes(t,n,o,r,!0,d);r?(r=k("#"+r.tId+e.id.UL),r.get(0)&&r.append(n.join(""))):t.treeObj.append(n.join(""));i.createNodeCallback(t)}},destroy:function(e){e&&(h.initCache(e),h.initRoot(e),m.unbindTree(e),m.unbindEvent(e),e.treeObj.empty())},expandCollapseNode:function(t,n,o,r,a){var d=h.getRoot(t),l=t.data.key.children;if(n){if(d.expandTriggerFlag){var s=a,a=function(){s&&s();n.open?t.treeObj.trigger(e.event.EXPAND,[t.treeId,n]):t.treeObj.trigger(e.event.COLLAPSE,[t.treeId,n])};d.expandTriggerFlag=!1}if(!n.open&&n.isParent&&(!k("#"+n.tId+e.id.UL).get(0)||n[l]&&n[l].length>0&&!k("#"+n[l][0].tId).get(0)))i.appendParentULDom(t,n),i.createNodeCallback(t);if(n.open==o)j.apply(a,[]);else{var o=k("#"+n.tId+e.id.UL),d=k("#"+n.tId+e.id.SWITCH),c=k("#"+n.tId+e.id.ICON);n.isParent?(n.open=!n.open,n.iconOpen&&n.iconClose&&c.attr("style",i.makeNodeIcoStyle(t,n)),n.open?(i.replaceSwitchClass(n,d,e.folder.OPEN),i.replaceIcoClass(n,c,e.folder.OPEN),r==!1||t.view.expandSpeed==""?(o.show(),j.apply(a,[])):n[l]&&n[l].length>0?o.slideDown(t.view.expandSpeed,a):(o.show(),j.apply(a,[]))):(i.replaceSwitchClass(n,d,e.folder.CLOSE),i.replaceIcoClass(n,c,e.folder.CLOSE),r==!1||t.view.expandSpeed==""||!(n[l]&&n[l].length>0)?(o.hide(),j.apply(a,[])):o.slideUp(t.view.expandSpeed,a))):j.apply(a,[])}}else j.apply(a,[])},expandCollapseParentNode:function(e,t,n,o,r){t&&(t.parentTId?(i.expandCollapseNode(e,t,n,o),t.parentTId&&i.expandCollapseParentNode(e,t.getParentNode(),n,o,r)):i.expandCollapseNode(e,t,n,o,r))},expandCollapseSonNode:function(e,t,n,o,r){var a=h.getRoot(e),d=e.data.key.children,a=t?t[d]:a[d],d=t?!1:o,l=h.getRoot(e).expandTriggerFlag;h.getRoot(e).expandTriggerFlag=!1;if(a)for(var s=0,c=a.length;s<c;s++)a[s]&&i.expandCollapseSonNode(e,a[s],n,d);h.getRoot(e).expandTriggerFlag=l;i.expandCollapseNode(e,t,n,o,r)},makeDOMNodeIcon:function(t,n,o){var r=h.getNodeName(n,o),r=n.view.nameIsHTML?r:r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");t.push("<span id='",o.tId,e.id.ICON,"' title='' treeNode",e.id.ICON," class='",i.makeNodeIcoClass(n,o),"' style='",i.makeNodeIcoStyle(n,o),"'></span><span id='",o.tId,e.id.SPAN,"'>",r,"</span>")},makeDOMNodeLine:function(t,n,o){t.push("<span id='",o.tId,e.id.SWITCH,"' title='' class='",i.makeNodeLineClass(n,o),"' treeNode",e.id.SWITCH,"></span>")},makeDOMNodeMainAfter:function(e){e.push("</li>")},makeDOMNodeMainBefore:function(t,n,o){t.push("<li id='",o.tId,"' class='",e.className.LEVEL,o.level,"' tabindex='0' hidefocus='true' treenode>")},makeDOMNodeNameAfter:function(e){e.push("</a>")},makeDOMNodeNameBefore:function(t,n,o){var r=h.getNodeTitle(n,o),a=i.makeNodeUrl(n,o),d=i.makeNodeFontCss(n,o),l=[],s;for(s in d)l.push(s,":",d[s],";");t.push("<a id='",o.tId,e.id.A,"' class='",e.className.LEVEL,o.level,"' treeNode",e.id.A,' onclick="',o.click||"",'" ',a!=null&&a.length>0?"href='"+a+"'":""," target='",i.makeNodeTarget(o),"' style='",l.join(""),"'");j.apply(n.view.showTitle,[n.treeId,o],n.view.showTitle)&&r&&t.push("title='",r.replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"'");t.push(">")},makeNodeFontCss:function(e,t){var n=j.apply(e.view.fontCss,[e.treeId,t],e.view.fontCss);return n&&typeof n!="function"?n:{}},makeNodeIcoClass:function(t,n){var o=["ico"];n.isAjaxing||(o[0]=(n.iconSkin?n.iconSkin+"_":"")+o[0],n.isParent?o.push(n.open?e.folder.OPEN:e.folder.CLOSE):o.push(e.folder.DOCU));return e.className.BUTTON+" "+o.join("_")},makeNodeIcoStyle:function(e,t){var n=[];if(!t.isAjaxing){var o=t.isParent&&t.iconOpen&&t.iconClose?t.open?t.iconOpen:t.iconClose:t.icon;o&&n.push("background:url(",o,") 0 0 no-repeat;");(e.view.showIcon==!1||!j.apply(e.view.showIcon,[e.treeId,t],!0))&&n.push("width:0px;height:0px;")}return n.join("")},makeNodeLineClass:function(t,n){var o=[];t.view.showLine?n.level==0&&n.isFirstNode&&n.isLastNode?o.push(e.line.ROOT):n.level==0&&n.isFirstNode?o.push(e.line.ROOTS):n.isLastNode?o.push(e.line.BOTTOM):o.push(e.line.CENTER):o.push(e.line.NOLINE);n.isParent?o.push(n.open?e.folder.OPEN:e.folder.CLOSE):o.push(e.folder.DOCU);return i.makeNodeLineClassEx(n)+o.join("_")},makeNodeLineClassEx:function(t){return e.className.BUTTON+" "+e.className.LEVEL+t.level+" "+e.className.SWITCH+" "},makeNodeTarget:function(e){return e.target||"_blank"},makeNodeUrl:function(e,t){var n=e.data.key.url;return t[n]?t[n]:null},makeUlHtml:function(t,n,o,r){o.push("<ul id='",n.tId,e.id.UL,"' class='",e.className.LEVEL,n.level," ",i.makeUlLineClass(t,n),"' style='display:",n.open?"block":"none","'>");o.push(r);o.push("</ul>")},makeUlLineClass:function(t,n){return t.view.showLine&&!n.isLastNode?e.line.LINE:""},removeChildNodes:function(t,n){if(n){var o=t.data.key.children,r=n[o];if(r){for(var a=0,d=r.length;a<d;a++)h.removeNodeCache(t,r[a]);h.removeSelectedNode(t);delete n[o];t.data.keep.parent?k("#"+n.tId+e.id.UL).empty():(n.isParent=!1,n.open=!1,o=k("#"+n.tId+e.id.SWITCH),r=k("#"+n.tId+e.id.ICON),i.replaceSwitchClass(n,o,e.folder.DOCU),i.replaceIcoClass(n,r,e.folder.DOCU),k("#"+n.tId+e.id.UL).remove())}}},setFirstNode:function(e,t){var n=e.data.key.children;if(t[n].length>0)t[n][0].isFirstNode=!0},setLastNode:function(e,t){var n=e.data.key.children,o=t[n].length;if(o>0)t[n][o-1].isLastNode=!0},removeNode:function(t,n){var o=h.getRoot(t),r=t.data.key.children,a=n.parentTId?n.getParentNode():o;n.isFirstNode=!1;n.isLastNode=!1;n.getPreNode=function(){return null};n.getNextNode=function(){return null};if(h.getNodeCache(t,n.tId)){k("#"+n.tId).remove();h.removeNodeCache(t,n);h.removeSelectedNode(t,n);for(var d=0,l=a[r].length;d<l;d++)if(a[r][d].tId==n.tId){a[r].splice(d,1);break}i.setFirstNode(t,a);i.setLastNode(t,a);var s,d=a[r].length;if(!t.data.keep.parent&&d==0)a.isParent=!1,a.open=!1,d=k("#"+a.tId+e.id.UL),l=k("#"+a.tId+e.id.SWITCH),s=k("#"+a.tId+e.id.ICON),i.replaceSwitchClass(a,l,e.folder.DOCU),i.replaceIcoClass(a,s,e.folder.DOCU),d.css("display","none");else if(t.view.showLine&&d>0){var c=a[r][d-1],d=k("#"+c.tId+e.id.UL),l=k("#"+c.tId+e.id.SWITCH);s=k("#"+c.tId+e.id.ICON);a==o?a[r].length==1?i.replaceSwitchClass(c,l,e.line.ROOT):(o=k("#"+a[r][0].tId+e.id.SWITCH),i.replaceSwitchClass(a[r][0],o,e.line.ROOTS),i.replaceSwitchClass(c,l,e.line.BOTTOM)):i.replaceSwitchClass(c,l,e.line.BOTTOM);d.removeClass(e.line.LINE)}}},replaceIcoClass:function(t,n,o){if(n&&!t.isAjaxing&&(t=n.attr("class"),t!=void 0)){t=t.split("_");switch(o){case e.folder.OPEN:case e.folder.CLOSE:case e.folder.DOCU:t[t.length-1]=o}n.attr("class",t.join("_"))}},replaceSwitchClass:function(t,n,o){if(n){var r=n.attr("class");if(r!=void 0){r=r.split("_");switch(o){case e.line.ROOT:case e.line.ROOTS:case e.line.CENTER:case e.line.BOTTOM:case e.line.NOLINE:r[0]=i.makeNodeLineClassEx(t)+o;break;case e.folder.OPEN:case e.folder.CLOSE:case e.folder.DOCU:r[1]=o}n.attr("class",r.join("_"));o!==e.folder.DOCU?n.removeAttr("disabled"):n.attr("disabled","disabled")}}},selectNode:function(t,n,o){o||i.cancelPreSelectedNode(t);k("#"+n.tId+e.id.A).addClass(e.node.CURSELECTED);h.addSelectedNode(t,n)},setNodeFontCss:function(t,n){var o=k("#"+n.tId+e.id.A),r=i.makeNodeFontCss(t,n);r&&o.css(r)},setNodeLineIcos:function(t,n){if(n){var o=k("#"+n.tId+e.id.SWITCH),r=k("#"+n.tId+e.id.UL),a=k("#"+n.tId+e.id.ICON),d=i.makeUlLineClass(t,n);d.length==0?r.removeClass(e.line.LINE):r.addClass(d);o.attr("class",i.makeNodeLineClass(t,n));n.isParent?o.removeAttr("disabled"):o.attr("disabled","disabled");a.removeAttr("style");a.attr("style",i.makeNodeIcoStyle(t,n));a.attr("class",i.makeNodeIcoClass(t,n))}},setNodeName:function(t,n){var o=h.getNodeTitle(t,n),r=k("#"+n.tId+e.id.SPAN);r.empty();t.view.nameIsHTML?r.html(h.getNodeName(t,n)):r.text(h.getNodeName(t,n));j.apply(t.view.showTitle,[t.treeId,n],t.view.showTitle)&&k("#"+n.tId+e.id.A).attr("title",!o?"":o)},setNodeTarget:function(t){k("#"+t.tId+e.id.A).attr("target",i.makeNodeTarget(t))},setNodeUrl:function(t,n){var o=k("#"+n.tId+e.id.A),r=i.makeNodeUrl(t,n);r==null||r.length==0?o.removeAttr("href"):o.attr("href",r)},switchNode:function(e,t){t.open||!j.canAsync(e,t)?i.expandCollapseNode(e,t,!t.open):e.async.enable?i.asyncNode(e,t)||i.expandCollapseNode(e,t,!t.open):t&&i.expandCollapseNode(e,t,!t.open)}};k.fn.zTree={consts:{className:{BUTTON:"button",LEVEL:"level",ICO_LOADING:"ico_loading",SWITCH:"switch"},event:{NODECREATED:"ztree_nodeCreated",CLICK:"ztree_click",EXPAND:"ztree_expand",COLLAPSE:"ztree_collapse",ASYNC_SUCCESS:"ztree_async_success",ASYNC_ERROR:"ztree_async_error"},id:{A:"_a",ICON:"_ico",SPAN:"_span",SWITCH:"_switch",UL:"_ul"},line:{ROOT:"root",ROOTS:"roots",CENTER:"center",BOTTOM:"bottom",NOLINE:"noline",LINE:"line"},folder:{OPEN:"open",CLOSE:"close",DOCU:"docu"},node:{CURSELECTED:"curSelectedNode"}},_z:{tools:j,view:i,event:m,data:h},getZTreeObj:function(e){return(e=h.getZTreeTools(e))?e:null},destroy:function(e){if(e&&e.length>0)i.destroy(h.getSetting(e));else for(var t in r)i.destroy(r[t])},init:function(t,n,o){var a=j.clone(L);k.extend(!0,a,n);a.treeId=t.attr("id");a.treeObj=t;a.treeObj.empty();r[a.treeId]=a;if(typeof document.body.style.maxHeight==="undefined")a.view.expandSpeed="";h.initRoot(a);t=h.getRoot(a);n=a.data.key.children;o=o?j.clone(j.isArray(o)?o:[o]):[];t[n]=a.data.simpleData.enable?h.transformTozTreeFormat(a,o):o;h.initCache(a);m.unbindTree(a);m.bindTree(a);m.unbindEvent(a);m.bindEvent(a);o={setting:a,addNodes:function(e,t,n){function o(){i.addNodes(a,e,r,n==!0)}if(!t)return null;e||(e=null);if(e&&!e.isParent&&a.data.keep.leaf)return null;var r=j.clone(j.isArray(t)?t:[t]);j.canAsync(a,e)?i.asyncNode(a,e,n,o):o();return r},cancelSelectedNode:function(e){i.cancelPreSelectedNode(this.setting,e)},destroy:function(){i.destroy(this.setting)},expandAll:function(e){e=!!e;i.expandCollapseSonNode(this.setting,null,e,!0);return e},expandNode:function(e,t,n,o,r){if(!e||!e.isParent)return null;t!==!0&&t!==!1&&(t=!e.open);if((r=!!r)&&t&&j.apply(a.callback.beforeExpand,[a.treeId,e],!0)==!1)return null;else if(r&&!t&&j.apply(a.callback.beforeCollapse,[a.treeId,e],!0)==!1)return null;t&&e.parentTId&&i.expandCollapseParentNode(this.setting,e.getParentNode(),t,!1);if(t===e.open&&!n)return null;h.getRoot(a).expandTriggerFlag=r;if(n)i.expandCollapseSonNode(this.setting,e,t,!0,function(){if(o!==!1)try{k("#"+e.tId).focus().blur()}catch(t){}});else if(e.open=!t,i.switchNode(this.setting,e),o!==!1)try{k("#"+e.tId).focus().blur()}catch(d){}return t},getNodes:function(){return h.getNodes(this.setting)},getNodeByParam:function(e,t,n){return!e?null:h.getNodeByParam(this.setting,n?n[this.setting.data.key.children]:h.getNodes(this.setting),e,t)},getNodeByTId:function(e){return h.getNodeCache(this.setting,e)},getNodesByParam:function(e,t,n){return!e?null:h.getNodesByParam(this.setting,n?n[this.setting.data.key.children]:h.getNodes(this.setting),e,t)},getNodesByParamFuzzy:function(e,t,n){return!e?null:h.getNodesByParamFuzzy(this.setting,n?n[this.setting.data.key.children]:h.getNodes(this.setting),e,t)},getNodesByFilter:function(e,t,n,o){t=!!t;return!e||typeof e!="function"?t?null:[]:h.getNodesByFilter(this.setting,n?n[this.setting.data.key.children]:h.getNodes(this.setting),e,t,o)},getNodeIndex:function(e){if(!e)return null;for(var t=a.data.key.children,n=e.parentTId?e.getParentNode():h.getRoot(this.setting),o=0,r=n[t].length;o<r;o++)if(n[t][o]==e)return o;return-1},getSelectedNodes:function(){for(var e=[],t=h.getRoot(this.setting).curSelectedList,n=0,o=t.length;n<o;n++)e.push(t[n]);return e},isSelectedNode:function(e){return h.isSelectedNode(this.setting,e)},reAsyncChildNodes:function(t,n,o){if(this.setting.async.enable){var r=!t;r&&(t=h.getRoot(this.setting));if(n=="refresh"){for(var n=this.setting.data.key.children,d=0,l=t[n]?t[n].length:0;d<l;d++)h.removeNodeCache(a,t[n][d]);h.removeSelectedNode(a);t[n]=[];r?this.setting.treeObj.empty():k("#"+t.tId+e.id.UL).empty()}i.asyncNode(this.setting,r?null:t,!!o)}},refresh:function(){this.setting.treeObj.empty();var e=h.getRoot(this.setting),t=e[this.setting.data.key.children];h.initRoot(this.setting);e[this.setting.data.key.children]=t;h.initCache(this.setting);i.createNodes(this.setting,0,e[this.setting.data.key.children])},removeChildNodes:function(e){if(!e)return null;var t=e[a.data.key.children];i.removeChildNodes(a,e);return t?t:null},removeNode:function(t,n){t&&(n=!!n,n&&j.apply(a.callback.beforeRemove,[a.treeId,t],!0)==!1||(i.removeNode(a,t),n&&this.setting.treeObj.trigger(e.event.REMOVE,[a.treeId,t])))},selectNode:function(e,t){if(e&&j.uCanDo(this.setting)){t=a.view.selectedMulti&&t;if(e.parentTId)i.expandCollapseParentNode(this.setting,e.getParentNode(),!0,!1,function(){try{k("#"+e.tId).focus().blur()}catch(t){}});else try{k("#"+e.tId).focus().blur()}catch(n){}i.selectNode(this.setting,e,t)}},transformTozTreeNodes:function(e){return h.transformTozTreeFormat(this.setting,e)},transformToArray:function(e){return h.transformToArrayFormat(this.setting,e)},updateNode:function(e){e&&k("#"+e.tId).get(0)&&j.uCanDo(this.setting)&&(i.setNodeName(this.setting,e),i.setNodeTarget(e),i.setNodeUrl(this.setting,e),i.setNodeLineIcos(this.setting,e),i.setNodeFontCss(this.setting,e))}};t.treeTools=o;h.setZTreeTools(a,o);t[n]&&t[n].length>0?i.createNodes(a,0,t[n]):a.async.enable&&a.async.url&&a.async.url!==""&&i.asyncNode(a);return o}};var M=k.fn.zTree,e=M.consts})(jQuery);(function(e){var t={event:{DRAG:"ztree_drag",DROP:"ztree_drop",REMOVE:"ztree_remove",RENAME:"ztree_rename"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}},n={onHoverOverNode:function(e,t){var o=d.getSetting(e.data.treeId),r=d.getRoot(o);if(r.curHoverNode!=t)n.onHoverOutNode(e);r.curHoverNode=t;i.addHoverDom(o,t)},onHoverOutNode:function(e){var e=d.getSetting(e.data.treeId),t=d.getRoot(e);if(t.curHoverNode&&!d.isSelectedNode(e,t.curHoverNode))i.removeTreeDom(e,t.curHoverNode),t.curHoverNode=null},onMousedownNode:function(n,o){function l(n){if(g.dragFlag==0&&Math.abs(w-n.clientX)<f.edit.drag.minMoveSize&&Math.abs(L-n.clientY)<f.edit.drag.minMoveSize)return!0;var o,l,c,u,p;p=f.data.key.children;e("body").css("cursor","pointer");if(g.dragFlag==0){if(r.apply(f.callback.beforeDrag,[f.treeId,m],!0)==!1)return s(n),!0;for(o=0,l=m.length;o<l;o++){if(o==0)g.dragNodeShowBefore=[];c=m[o];c.isParent&&c.open?(i.expandCollapseNode(f,c,!c.open),g.dragNodeShowBefore[c.tId]=!0):g.dragNodeShowBefore[c.tId]=!1}g.dragFlag=1;g.showHoverDom=!1;r.showIfameMask(f,!0);c=!0;u=-1;if(m.length>1){var N=m[0].parentTId?m[0].getParentNode()[p]:d.getNodes(f);p=[];for(o=0,l=N.length;o<l;o++)if(g.dragNodeShowBefore[N[o].tId]!==void 0&&(c&&u>-1&&u+1!==o&&(c=!1),p.push(N[o]),u=o),m.length===p.length){m=p;break}}c&&(C=m[0].getPreNode(),k=m[m.length-1].getNextNode());I=e("<ul class='zTreeDragUL'></ul>");for(o=0,l=m.length;o<l;o++)if(c=m[o],c.editNameFlag=!1,i.selectNode(f,c,o>0),i.removeTreeDom(f,c),u=e("<li id='"+c.tId+"_tmp'></li>"),u.append(e("#"+c.tId+a.id.A).clone()),u.css("padding","0"),u.children("#"+c.tId+a.id.A).removeClass(a.node.CURSELECTED),I.append(u),o==f.edit.drag.maxShowNodeNum-1){u=e("<li id='"+c.tId+"_moretmp'><a>  ...  </a></li>");I.append(u);break}I.attr("id",m[0].tId+a.id.UL+"_tmp");I.addClass(f.treeObj.attr("class"));I.appendTo("body");T=e("<span class='tmpzTreeMove_arrow'></span>");T.attr("id","zTreeMove_arrow_tmp");T.appendTo("body");f.treeObj.trigger(a.event.DRAG,[n,f.treeId,m])}if(g.dragFlag==1){y&&T.attr("id")==n.target.id&&R&&n.clientX+v.scrollLeft()+2>e("#"+R+a.id.A,y).offset().left?(c=e("#"+R+a.id.A,y),n.target=c.length>0?c.get(0):n.target):y&&(y.removeClass(a.node.TMPTARGET_TREE),R&&e("#"+R+a.id.A,y).removeClass(a.node.TMPTARGET_NODE+"_"+a.move.TYPE_PREV).removeClass(a.node.TMPTARGET_NODE+"_"+t.move.TYPE_NEXT).removeClass(a.node.TMPTARGET_NODE+"_"+t.move.TYPE_INNER));R=y=null;b=!1;E=f;c=d.getSettings();for(var h in c)if(c[h].treeId&&c[h].edit.enable&&c[h].treeId!=f.treeId&&(n.target.id==c[h].treeId||e(n.target).parents("#"+c[h].treeId).length>0))b=!0,E=c[h];h=v.scrollTop();u=v.scrollLeft();p=E.treeObj.offset();o=E.treeObj.get(0).scrollHeight;c=E.treeObj.get(0).scrollWidth;l=n.clientY+h-p.top;var A=E.treeObj.height()+p.top-n.clientY-h,j=n.clientX+u-p.left,x=E.treeObj.width()+p.left-n.clientX-u;p=l<f.edit.drag.borderMax&&l>f.edit.drag.borderMin;
var N=A<f.edit.drag.borderMax&&A>f.edit.drag.borderMin,M=j<f.edit.drag.borderMax&&j>f.edit.drag.borderMin,_=x<f.edit.drag.borderMax&&x>f.edit.drag.borderMin,A=l>f.edit.drag.borderMin&&A>f.edit.drag.borderMin&&j>f.edit.drag.borderMin&&x>f.edit.drag.borderMin,j=p&&E.treeObj.scrollTop()<=0,x=N&&E.treeObj.scrollTop()+E.treeObj.height()+10>=o,U=M&&E.treeObj.scrollLeft()<=0,B=_&&E.treeObj.scrollLeft()+E.treeObj.width()+10>=c;if(n.target.id&&E.treeObj.find("#"+n.target.id).length>0){for(var z=n.target;z&&z.tagName&&!r.eqs(z.tagName,"li")&&z.id!=E.treeId;)z=z.parentNode;var F=!0;for(o=0,l=m.length;o<l;o++)if(c=m[o],z.id===c.tId){F=!1;break}else if(e("#"+c.tId).find("#"+z.id).length>0){F=!1;break}if(F&&n.target.id&&(n.target.id==z.id+a.id.A||e(n.target).parents("#"+z.id+a.id.A).length>0))y=e(z),R=z.id}c=m[0];if(A&&(n.target.id==E.treeId||e(n.target).parents("#"+E.treeId).length>0)){if(!y&&(n.target.id==E.treeId||j||x||U||B)&&(b||!b&&c.parentTId))y=E.treeObj;p?E.treeObj.scrollTop(E.treeObj.scrollTop()-10):N&&E.treeObj.scrollTop(E.treeObj.scrollTop()+10);M?E.treeObj.scrollLeft(E.treeObj.scrollLeft()-10):_&&E.treeObj.scrollLeft(E.treeObj.scrollLeft()+10);y&&y!=E.treeObj&&y.offset().left<E.treeObj.offset().left&&E.treeObj.scrollLeft(E.treeObj.scrollLeft()+y.offset().left-E.treeObj.offset().left)}I.css({top:n.clientY+h+3+"px",left:n.clientX+u+3+"px"});p=o=0;if(y&&y.attr("id")!=E.treeId){var Y=R==null?null:d.getNodeCache(E,R);l=n.ctrlKey&&f.edit.drag.isMove&&f.edit.drag.isCopy||!f.edit.drag.isMove&&f.edit.drag.isCopy;o=!!(C&&R===C.tId);p=!!(k&&R===k.tId);u=c.parentTId&&c.parentTId==R;c=(l||!p)&&r.apply(E.edit.drag.prev,[E.treeId,m,Y],!!E.edit.drag.prev);o=(l||!o)&&r.apply(E.edit.drag.next,[E.treeId,m,Y],!!E.edit.drag.next);_=(l||!u)&&!(E.data.keep.leaf&&!Y.isParent)&&r.apply(E.edit.drag.inner,[E.treeId,m,Y],!!E.edit.drag.inner);if(!c&&!o&&!_){if(y=null,R="",S=a.move.TYPE_INNER,T.css({display:"none"}),window.zTreeMoveTimer)clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null}else{l=e("#"+R+a.id.A,y);p=Y.isLastNode?null:e("#"+Y.getNextNode().tId+a.id.A,y.next());N=l.offset().top;u=l.offset().left;M=c?_?.25:o?.5:1:-1;_=o?_?.75:c?.5:0:-1;n=(n.clientY+h-N)/l.height();(M==1||n<=M&&n>=-.2)&&c?(o=1-T.width(),p=N-T.height()/2,S=a.move.TYPE_PREV):(_==0||n>=_&&n<=1.2)&&o?(o=1-T.width(),p=p==null||Y.isParent&&Y.open?N+l.height()-T.height()/2:p.offset().top-T.height()/2,S=a.move.TYPE_NEXT):(o=5-T.width(),p=N,S=a.move.TYPE_INNER);T.css({display:"block",top:p+"px",left:u+o+"px"});l.addClass(a.node.TMPTARGET_NODE+"_"+S);if(P!=R||O!=S)D=(new Date).getTime();if(Y&&Y.isParent&&S==a.move.TYPE_INNER&&(n=!0,window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==Y.tId?(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null):window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===Y.tId&&(n=!1),n))window.zTreeMoveTimer=setTimeout(function(){S==a.move.TYPE_INNER&&Y&&Y.isParent&&!Y.open&&(new Date).getTime()-D>E.edit.drag.autoOpenTime&&r.apply(E.callback.beforeDragOpen,[E.treeId,Y],!0)&&(i.switchNode(E,Y),E.edit.drag.autoExpandTrigger&&E.treeObj.trigger(a.event.EXPAND,[E.treeId,Y]))},E.edit.drag.autoOpenTime+50),window.zTreeMoveTargetNodeTId=Y.tId}}else if(S=a.move.TYPE_INNER,y&&r.apply(E.edit.drag.inner,[E.treeId,m,null],!!E.edit.drag.inner)?y.addClass(a.node.TMPTARGET_TREE):y=null,T.css({display:"none"}),window.zTreeMoveTimer)clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null;P=R;O=S}return!1}function s(n){if(window.zTreeMoveTimer)clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null;O=P=null;v.unbind("mousemove",l);v.unbind("mouseup",s);v.unbind("selectstart",c);e("body").css("cursor","auto");y&&(y.removeClass(a.node.TMPTARGET_TREE),R&&e("#"+R+a.id.A,y).removeClass(a.node.TMPTARGET_NODE+"_"+a.move.TYPE_PREV).removeClass(a.node.TMPTARGET_NODE+"_"+t.move.TYPE_NEXT).removeClass(a.node.TMPTARGET_NODE+"_"+t.move.TYPE_INNER));r.showIfameMask(f,!1);g.showHoverDom=!0;if(g.dragFlag!=0){g.dragFlag=0;var o,u,p;for(o=0,u=m.length;o<u;o++)p=m[o],p.isParent&&g.dragNodeShowBefore[p.tId]&&!p.open&&(i.expandCollapseNode(f,p,!p.open),delete g.dragNodeShowBefore[p.tId]);I&&I.remove();T&&T.remove();var N=n.ctrlKey&&f.edit.drag.isMove&&f.edit.drag.isCopy||!f.edit.drag.isMove&&f.edit.drag.isCopy;!N&&y&&R&&m[0].parentTId&&R==m[0].parentTId&&S==a.move.TYPE_INNER&&(y=null);if(y){var h=R==null?null:d.getNodeCache(E,R);if(r.apply(f.callback.beforeDrop,[E.treeId,m,h,S,N],!0)!=!1){var C=N?r.clone(m):m;o=function(){if(b){if(!N)for(var t=0,o=m.length;t<o;t++)i.removeNode(f,m[t]);if(S==a.move.TYPE_INNER)i.addNodes(E,h,C);else if(i.addNodes(E,h.getParentNode(),C),S==a.move.TYPE_PREV)for(t=0,o=C.length;t<o;t++)i.moveNode(E,h,C[t],S,!1);else for(t=-1,o=C.length-1;t<o;o--)i.moveNode(E,h,C[o],S,!1)}else if(N&&S==a.move.TYPE_INNER)i.addNodes(E,h,C);else if(N&&i.addNodes(E,h.getParentNode(),C),S!=a.move.TYPE_NEXT)for(t=0,o=C.length;t<o;t++)i.moveNode(E,h,C[t],S,!1);else for(t=-1,o=C.length-1;t<o;o--)i.moveNode(E,h,C[o],S,!1);for(t=0,o=C.length;t<o;t++)i.selectNode(E,C[t],t>0);e("#"+C[0].tId).focus().blur();f.treeObj.trigger(a.event.DROP,[n,E.treeId,C,h,S,N])};S==a.move.TYPE_INNER&&r.canAsync(E,h)?i.asyncNode(E,h,!1,o):o()}}else{for(o=0,u=m.length;o<u;o++)i.selectNode(E,m[o],o>0);f.treeObj.trigger(a.event.DROP,[n,f.treeId,m,null,null,null])}}}function c(){return!1}var u,p,f=d.getSetting(n.data.treeId),g=d.getRoot(f);if(n.button==2||!f.edit.enable||!f.edit.drag.isCopy&&!f.edit.drag.isMove)return!0;var N=n.target,h=d.getRoot(f).curSelectedList,m=[];if(d.isSelectedNode(f,o))for(u=0,p=h.length;u<p;u++){if(h[u].editNameFlag&&r.eqs(N.tagName,"input")&&N.getAttribute("treeNode"+a.id.INPUT)!==null)return!0;m.push(h[u]);if(m[0].parentTId!==h[u].parentTId){m=[o];break}}else m=[o];i.editNodeBlur=!0;i.cancelCurEditNode(f,null,!0);var v=e(document),I,T,y,b=!1,E=f,C,k,P=null,O=null,R=null,S=a.move.TYPE_INNER,w=n.clientX,L=n.clientY,D=(new Date).getTime();r.uCanDo(f)&&v.bind("mousemove",l);v.bind("mouseup",s);v.bind("selectstart",c);n.preventDefault&&n.preventDefault();return!0}};e.extend(!0,e.fn.zTree.consts,t);e.extend(!0,e.fn.zTree._z,{tools:{getAbs:function(e){e=e.getBoundingClientRect();return[e.left,e.top]},inputFocus:function(e){e.get(0)&&(e.focus(),r.setCursorPosition(e.get(0),e.val().length))},inputSelect:function(e){e.get(0)&&(e.focus(),e.select())},setCursorPosition:function(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0);n.moveEnd("character",t);n.moveStart("character",t);n.select()}},showIfameMask:function(t,n){for(var o=d.getRoot(t);o.dragMaskList.length>0;)o.dragMaskList[0].remove(),o.dragMaskList.shift();if(n)for(var a=e("iframe"),i=0,l=a.length;i<l;i++){var s=a.get(i),c=r.getAbs(s),s=e("<div id='zTreeMask_"+i+"' class='zTreeMask' style='top:"+c[1]+"px; left:"+c[0]+"px; width:"+s.offsetWidth+"px; height:"+s.offsetHeight+"px;'></div>");s.appendTo("body");o.dragMaskList.push(s)}}},view:{addEditBtn:function(t,n){if(!(n.editNameFlag||e("#"+n.tId+a.id.EDIT).length>0)&&r.apply(t.edit.showRenameBtn,[t.treeId,n],t.edit.showRenameBtn)){var o=e("#"+n.tId+a.id.A),d="<span class='"+a.className.BUTTON+" edit' id='"+n.tId+a.id.EDIT+"' title='"+r.apply(t.edit.renameTitle,[t.treeId,n],t.edit.renameTitle)+"' treeNode"+a.id.EDIT+" style='display:none;'></span>";o.append(d);e("#"+n.tId+a.id.EDIT).bind("click",function(){if(!r.uCanDo(t)||r.apply(t.callback.beforeEditName,[t.treeId,n],!0)==!1)return!1;i.editNode(t,n);return!1}).show()}},addRemoveBtn:function(t,n){if(!(n.editNameFlag||e("#"+n.tId+a.id.REMOVE).length>0)&&r.apply(t.edit.showRemoveBtn,[t.treeId,n],t.edit.showRemoveBtn)){var o=e("#"+n.tId+a.id.A),d="<span class='"+a.className.BUTTON+" remove' id='"+n.tId+a.id.REMOVE+"' title='"+r.apply(t.edit.removeTitle,[t.treeId,n],t.edit.removeTitle)+"' treeNode"+a.id.REMOVE+" style='display:none;'></span>";o.append(d);e("#"+n.tId+a.id.REMOVE).bind("click",function(){if(!r.uCanDo(t)||r.apply(t.callback.beforeRemove,[t.treeId,n],!0)==!1)return!1;i.removeNode(t,n);t.treeObj.trigger(a.event.REMOVE,[t.treeId,n]);return!1}).bind("mousedown",function(){return!0}).show()}},addHoverDom:function(e,t){if(d.getRoot(e).showHoverDom)t.isHover=!0,e.edit.enable&&(i.addEditBtn(e,t),i.addRemoveBtn(e,t)),r.apply(e.view.addHoverDom,[e.treeId,t])},cancelCurEditNode:function(t,n){var o=d.getRoot(t),l=t.data.key.name,s=o.curEditNode;if(s){var c=o.curEditInput,u=n?n:c.val();if(!n&&r.apply(t.callback.beforeRename,[t.treeId,s,u],!0)===!1)return!1;else s[l]=u?u:c.val(),n||t.treeObj.trigger(a.event.RENAME,[t.treeId,s]);e("#"+s.tId+a.id.A).removeClass(a.node.CURSELECTED_EDIT);c.unbind();i.setNodeName(t,s);s.editNameFlag=!1;o.curEditNode=null;o.curEditInput=null;i.selectNode(t,s,!1)}return o.noSelection=!0},editNode:function(t,n){var o=d.getRoot(t);i.editNodeBlur=!1;if(d.isSelectedNode(t,n)&&o.curEditNode==n&&n.editNameFlag)setTimeout(function(){r.inputFocus(o.curEditInput)},0);else{var l=t.data.key.name;n.editNameFlag=!0;i.removeTreeDom(t,n);i.cancelCurEditNode(t);i.selectNode(t,n,!1);e("#"+n.tId+a.id.SPAN).html("<input type=text class='rename' id='"+n.tId+a.id.INPUT+"' treeNode"+a.id.INPUT+" >");var s=e("#"+n.tId+a.id.INPUT);s.attr("value",n[l]);t.edit.editNameSelectAll?r.inputSelect(s):r.inputFocus(s);s.bind("blur",function(){i.editNodeBlur||i.cancelCurEditNode(t)}).bind("keydown",function(e){e.keyCode=="13"?(i.editNodeBlur=!0,i.cancelCurEditNode(t,null,!0)):e.keyCode=="27"&&i.cancelCurEditNode(t,n[l])}).bind("click",function(){return!1}).bind("dblclick",function(){return!1});e("#"+n.tId+a.id.A).addClass(a.node.CURSELECTED_EDIT);o.curEditInput=s;o.noSelection=!1;o.curEditNode=n}},moveNode:function(t,n,o,r,l,s){var c=d.getRoot(t),u=t.data.key.children;if(n!=o&&(!t.data.keep.leaf||!n||n.isParent||r!=a.move.TYPE_INNER)){var p=o.parentTId?o.getParentNode():c,f=n===null||n==c;f&&n===null&&(n=c);if(f)r=a.move.TYPE_INNER;c=n.parentTId?n.getParentNode():c;if(r!=a.move.TYPE_PREV&&r!=a.move.TYPE_NEXT)r=a.move.TYPE_INNER;if(r==a.move.TYPE_INNER)if(f)o.parentTId=null;else{if(!n.isParent)n.isParent=!0,n.open=!!n.open,i.setNodeLineIcos(t,n);o.parentTId=n.tId}var g;f?g=f=t.treeObj:(!s&&r==a.move.TYPE_INNER?i.expandCollapseNode(t,n,!0,!1):s||i.expandCollapseNode(t,n.getParentNode(),!0,!1),f=e("#"+n.tId),g=e("#"+n.tId+a.id.UL),f.get(0)&&!g.get(0)&&(g=[],i.makeUlHtml(t,n,g,""),f.append(g.join(""))),g=e("#"+n.tId+a.id.UL));var N=e("#"+o.tId);N.get(0)?f.get(0)||N.remove():N=i.appendNodes(t,o.level,[o],null,!1,!0).join("");g.get(0)&&r==a.move.TYPE_INNER?g.append(N):f.get(0)&&r==a.move.TYPE_PREV?f.before(N):f.get(0)&&r==a.move.TYPE_NEXT&&f.after(N);var h=-1,m=0,v=null,f=null,I=o.level;if(o.isFirstNode){if(h=0,p[u].length>1)v=p[u][1],v.isFirstNode=!0}else if(o.isLastNode)h=p[u].length-1,v=p[u][h-1],v.isLastNode=!0;else for(g=0,N=p[u].length;g<N;g++)if(p[u][g].tId==o.tId){h=g;break}h>=0&&p[u].splice(h,1);if(r!=a.move.TYPE_INNER)for(g=0,N=c[u].length;g<N;g++)c[u][g].tId==n.tId&&(m=g);if(r==a.move.TYPE_INNER){n[u]||(n[u]=[]);if(n[u].length>0)f=n[u][n[u].length-1],f.isLastNode=!1;n[u].splice(n[u].length,0,o);o.isLastNode=!0;o.isFirstNode=n[u].length==1}else n.isFirstNode&&r==a.move.TYPE_PREV?(c[u].splice(m,0,o),f=n,f.isFirstNode=!1,o.parentTId=n.parentTId,o.isFirstNode=!0,o.isLastNode=!1):n.isLastNode&&r==a.move.TYPE_NEXT?(c[u].splice(m+1,0,o),f=n,f.isLastNode=!1,o.parentTId=n.parentTId,o.isFirstNode=!1,o.isLastNode=!0):(r==a.move.TYPE_PREV?c[u].splice(m,0,o):c[u].splice(m+1,0,o),o.parentTId=n.parentTId,o.isFirstNode=!1,o.isLastNode=!1);d.fixPIdKeyValue(t,o);d.setSonNodeLevel(t,o.getParentNode(),o);i.setNodeLineIcos(t,o);i.repairNodeLevelClass(t,o,I);!t.data.keep.parent&&p[u].length<1?(p.isParent=!1,p.open=!1,n=e("#"+p.tId+a.id.UL),r=e("#"+p.tId+a.id.SWITCH),u=e("#"+p.tId+a.id.ICON),i.replaceSwitchClass(p,r,a.folder.DOCU),i.replaceIcoClass(p,u,a.folder.DOCU),n.css("display","none")):v&&i.setNodeLineIcos(t,v);f&&i.setNodeLineIcos(t,f);t.check&&t.check.enable&&i.repairChkClass&&(i.repairChkClass(t,p),i.repairParentChkClassWithSelf(t,p),p!=o.parent&&i.repairParentChkClassWithSelf(t,o));s||i.expandCollapseParentNode(t,o.getParentNode(),!0,l)}},removeEditBtn:function(t){e("#"+t.tId+a.id.EDIT).unbind().remove()},removeRemoveBtn:function(t){e("#"+t.tId+a.id.REMOVE).unbind().remove()},removeTreeDom:function(e,t){t.isHover=!1;i.removeEditBtn(t);i.removeRemoveBtn(t);r.apply(e.view.removeHoverDom,[e.treeId,t])},repairNodeLevelClass:function(t,n,o){if(o!==n.level){var t=e("#"+n.tId),r=e("#"+n.tId+a.id.A),i=e("#"+n.tId+a.id.UL),o=a.className.LEVEL+o,n=a.className.LEVEL+n.level;t.removeClass(o);t.addClass(n);r.removeClass(o);r.addClass(n);i.removeClass(o);i.addClass(n)}}},event:{},data:{setSonNodeLevel:function(e,t,n){if(n){var o=e.data.key.children;n.level=t?t.level+1:0;if(n[o])for(var t=0,r=n[o].length;t<r;t++)n[o][t]&&d.setSonNodeLevel(e,n,n[o][t])}}}});var o=e.fn.zTree,r=o._z.tools,a=o.consts,i=o._z.view,d=o._z.data;d.exSetting({edit:{enable:!1,editNameSelectAll:!1,showRemoveBtn:!0,showRenameBtn:!0,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:!1,isCopy:!0,isMove:!0,prev:!0,next:!0,inner:!0,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDrop:null,onRename:null}});d.addInitBind(function(e){var t=e.treeObj,n=a.event;t.bind(n.RENAME,function(t,n,o){r.apply(e.callback.onRename,[t,n,o])});t.bind(n.REMOVE,function(t,n,o){r.apply(e.callback.onRemove,[t,n,o])});t.bind(n.DRAG,function(t,n,o,a){r.apply(e.callback.onDrag,[n,o,a])});t.bind(n.DROP,function(t,n,o,a,i,d,l){r.apply(e.callback.onDrop,[n,o,a,i,d,l])})});d.addInitUnBind(function(e){var e=e.treeObj,t=a.event;e.unbind(t.RENAME);e.unbind(t.REMOVE);e.unbind(t.DRAG);e.unbind(t.DROP)});d.addInitCache(function(){});d.addInitNode(function(e,t,n){if(n)n.isHover=!1,n.editNameFlag=!1});d.addInitProxy(function(e){var t=e.target,o=d.getSetting(e.data.treeId),i=e.relatedTarget,l="",s=null,c="",u=null,p=null;if(r.eqs(e.type,"mouseover")){if(p=r.getMDom(o,t,[{tagName:"a",attrName:"treeNode"+a.id.A}]))l=p.parentNode.id,c="hoverOverNode"}else if(r.eqs(e.type,"mouseout"))p=r.getMDom(o,i,[{tagName:"a",attrName:"treeNode"+a.id.A}]),p||(l="remove",c="hoverOutNode");else if(r.eqs(e.type,"mousedown")&&(p=r.getMDom(o,t,[{tagName:"a",attrName:"treeNode"+a.id.A}])))l=p.parentNode.id,c="mousedownNode";if(l.length>0)switch(s=d.getNodeCache(o,l),c){case"mousedownNode":u=n.onMousedownNode;break;case"hoverOverNode":u=n.onHoverOverNode;break;case"hoverOutNode":u=n.onHoverOutNode}return{stop:!1,node:s,nodeEventType:c,nodeEventCallback:u,treeEventType:"",treeEventCallback:null}});d.addInitRoot(function(e){e=d.getRoot(e);e.curEditNode=null;e.curEditInput=null;e.curHoverNode=null;e.dragFlag=0;e.dragNodeShowBefore=[];e.dragMaskList=[];e.showHoverDom=!0});d.addZTreeTools(function(t,n){n.cancelEditName=function(e){var n=d.getRoot(t),o=t.data.key.name,r=n.curEditNode;n.curEditNode&&i.cancelCurEditNode(t,e?e:r[o])};n.copyNode=function(e,n,o,d){if(!n)return null;if(e&&!e.isParent&&t.data.keep.leaf&&o===a.move.TYPE_INNER)return null;var l=r.clone(n);if(!e)e=null,o=a.move.TYPE_INNER;o==a.move.TYPE_INNER?(n=function(){i.addNodes(t,e,[l],d)},r.canAsync(t,e)?i.asyncNode(t,e,d,n):n()):(i.addNodes(t,e.parentNode,[l],d),i.moveNode(t,e,l,o,!1,d));return l};n.editName=function(e){e&&e.tId&&e===d.getNodeCache(t,e.tId)&&(e.parentTId&&i.expandCollapseParentNode(t,e.getParentNode(),!0),i.editNode(t,e))};n.moveNode=function(n,o,d,l){function s(){i.moveNode(t,n,o,d,!1,l)}if(!o)return o;if(n&&!n.isParent&&t.data.keep.leaf&&d===a.move.TYPE_INNER)return null;else if(n&&(o.parentTId==n.tId&&d==a.move.TYPE_INNER||e("#"+o.tId).find("#"+n.tId).length>0))return null;else n||(n=null);r.canAsync(t,n)&&d===a.move.TYPE_INNER?i.asyncNode(t,n,l,s):s();return o};n.setEditable=function(e){t.edit.enable=e;return this.refresh()}});var l=i.cancelPreSelectedNode;i.cancelPreSelectedNode=function(e,t){for(var n=d.getRoot(e).curSelectedList,o=0,r=n.length;o<r;o++)if(!t||t===n[o])if(i.removeTreeDom(e,n[o]),t)break;l&&l.apply(i,arguments)};var s=i.createNodes;i.createNodes=function(e,t,n,o){s&&s.apply(i,arguments);n&&i.repairParentChkClassWithSelf&&i.repairParentChkClassWithSelf(e,o)};var c=i.makeNodeUrl;i.makeNodeUrl=function(e,t){return e.edit.enable?null:c.apply(i,arguments)};var u=i.removeNode;i.removeNode=function(e,t){var n=d.getRoot(e);if(n.curEditNode===t)n.curEditNode=null;u&&u.apply(i,arguments)};var p=i.selectNode;i.selectNode=function(e,t,n){var o=d.getRoot(e);if(d.isSelectedNode(e,t)&&o.curEditNode==t&&t.editNameFlag)return!1;p&&p.apply(i,arguments);i.addHoverDom(e,t);return!0};var f=r.uCanDo;r.uCanDo=function(e,t){var n=d.getRoot(e);return t&&(r.eqs(t.type,"mouseover")||r.eqs(t.type,"mouseout")||r.eqs(t.type,"mousedown")||r.eqs(t.type,"mouseup"))?!0:!n.curEditNode&&(f?f.apply(i,arguments):!0)}})(jQuery);